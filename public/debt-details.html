<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Debt Details - BDGTR</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <link rel="stylesheet" href="styles/reset.css" />
  <link rel="stylesheet" href="styles/main.css" />
  <link rel="stylesheet" href="styles/navigation.css" />
  <link rel="stylesheet" href="styles/debt-details.css" />
  <link rel="stylesheet" href="styles/responsive.css" />
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    function DebtDetailsForm() {
      const [debtTypes, setDebtTypes] = React.useState([]);
      const [otherDebt, setOtherDebt] = React.useState('');
      const [totalDebt, setTotalDebt] = React.useState('');
      const [monthlyPayments, setMonthlyPayments] = React.useState('');
      const [behindPayments, setBehindPayments] = React.useState('');

      const toggleDebtType = (value) => {
        setDebtTypes((prev) =>
          prev.includes(value)
            ? prev.filter((v) => v !== value)
            : [...prev, value]
        );
      };

      const handleExclusiveCheckbox = (value) => {
        setBehindPayments((prev) => (prev === value ? '' : value));
      };

      const handleSubmit = async (e) => {
        e.preventDefault();

        const signupData = JSON.parse(localStorage.getItem('signupData') || '{}');
        const incomeCashData = JSON.parse(localStorage.getItem('incomeCashData') || '{}');
        const debtCheckData = JSON.parse(localStorage.getItem('debtCheckData') || '{}');

        const fullUserData = {
          ...signupData,
          ...incomeCashData,
          ...debtCheckData,
          debtTypes,
          otherDebt,
          totalDebt,
          monthlyPayments,
          behindPayments
        };

        try {
          const response = await fetch(`${window.location.origin}/signup`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(fullUserData)
          });

          const result = await response.json();

          if (response.ok) {
            localStorage.setItem('bdgtrUser', JSON.stringify(fullUserData));
            window.location.href = 'index.html';
          } else {
            alert(result.message || "Signup failed.");
          }
        } catch (err) {
          alert("Error: " + err.message);
        }
      };

      return (
        <div className="signup-container">
          <div className="signup-right">
            <h2>Tell Us About Your Debt</h2>
            <form onSubmit={handleSubmit}>

              <label>What type of debt do you have? (Select all that apply)</label>
              <div className="checkbox-list">
                {[
                  ['credit', 'Credit card'],
                  ['student', 'Student loans'],
                  ['mortgage', 'Mortgage'],
                  ['auto', 'Auto loans'],
                  ['personal', 'Personal loans'],
                  ['bnpl', 'Buy-now-pay-later'],
                  ['other', 'Other']
                ].map(([value, label]) => (
                  <label key={value}>
                    <input
                      type="checkbox"
                      name="debtType"
                      value={value}
                      checked={debtTypes.includes(value)}
                      onChange={() => toggleDebtType(value)}
                    />
                    {label}
                  </label>
                ))}
              </div>

              <input
                type="text"
                name="otherDebt"
                placeholder="Other debt type"
                className="text-input"
                value={otherDebt}
                onChange={(e) => setOtherDebt(e.target.value)}
              />

              <label htmlFor="totalDebt">Total Current Debt (CAD)</label>
              <input
                type="number"
                id="totalDebt"
                name="totalDebt"
                placeholder="e.g. 15000"
                className="text-input"
                value={totalDebt}
                onChange={(e) => setTotalDebt(e.target.value)}
              />

              <label htmlFor="monthlyPayments">Total Monthly Debt Payments (CAD)</label>
              <input
                type="number"
                id="monthlyPayments"
                name="monthlyPayments"
                placeholder="e.g. 800"
                className="text-input"
                value={monthlyPayments}
                onChange={(e) => setMonthlyPayments(e.target.value)}
              />

              <p className="info-note">
                ℹ️ This includes minimum payments on all debts.
              </p>

              <label>Are you currently behind on any payments?</label>
              <div className="checkbox-group">
                {['yes', 'no', 'skip'].map((val) => (
                  <label key={val}>
                    <input
                      type="checkbox"
                      name="behindPayments"
                      value={val}
                      checked={behindPayments === val}
                      onChange={() => handleExclusiveCheckbox(val)}
                    />
                    {val.charAt(0).toUpperCase() + val.slice(1)}
                  </label>
                ))}
              </div>

              <div className="button-group">
                <button
                  type="button"
                  onClick={() => window.location.href = 'debt-check.html'}
                  className="signup-button outline"
                >
                  Back
                </button>
                <button type="submit" className="signup-button">Submit</button>
                <button
                  type="button"
                  onClick={() => window.location.href = 'index.html'}
                  className="signup-button outline"
                >
                  Skip
                </button>
              </div>
            </form>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<DebtDetailsForm />);
  </script>
</body>
</html>
